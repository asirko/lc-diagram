"use strict";(self.webpackChunklc_diagram=self.webpackChunklc_diagram||[]).push([[470],{6470:(fr,At,c)=>{c.r(At),c.d(At,{default:()=>hr});var _=c(6814),Ge=c(8237),Pe=c(239),o=c(5879),b=c(2438),G=c(2181),Dt=c(9397),Mt=c(4716),P=c(9773),ke=c(6321),Be=c(9360),wt=c(4829),J=c(8251),Re=c(4825);function bt(n,t=ke.z){return function He(n){return(0,Be.e)((t,r)=>{let e=!1,s=null,i=null,a=!1;const l=()=>{if(i?.unsubscribe(),i=null,e){e=!1;const h=s;s=null,r.next(h)}a&&r.complete()},u=()=>{i=null,a&&r.complete()};t.subscribe((0,J.x)(r,h=>{e=!0,s=h,i||(0,wt.Xf)(n(h)).subscribe(i=(0,J.x)(r,l,u))},()=>{a=!0,(!e||!i||i.closed)&&r.complete()}))})}(()=>(0,Re.H)(n,t))}var Ue=c(1954),$e=c(7394);const x={schedule(n){let t=requestAnimationFrame,r=cancelAnimationFrame;const{delegate:e}=x;e&&(t=e.requestAnimationFrame,r=e.cancelAnimationFrame);const s=t(i=>{r=void 0,n(i)});return new $e.w0(()=>r?.(s))},requestAnimationFrame(...n){const{delegate:t}=x;return(t?.requestAnimationFrame||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=x;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...n)},delegate:void 0};var Le=c(2631);const Et=new class Ye extends Le.v{flush(t){this._active=!0;const r=this._scheduled;this._scheduled=void 0;const{actions:e}=this;let s;t=t||e.shift();do{if(s=t.execute(t.state,t.delay))break}while((t=e[0])&&t.id===r&&e.shift());if(this._active=!1,s){for(;(t=e[0])&&t.id===r&&e.shift();)t.unsubscribe();throw s}}}(class je extends Ue.o{constructor(t,r){super(t,r),this.scheduler=t,this.work=r}requestAsyncId(t,r,e=0){return null!==e&&e>0?super.requestAsyncId(t,r,e):(t.actions.push(this),t._scheduled||(t._scheduled=x.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,r,e=0){var s;if(null!=e?e>0:this.delay>0)return super.recycleAsyncId(t,r,e);const{actions:i}=t;null!=r&&(null===(s=i[i.length-1])||void 0===s?void 0:s.id)!==r&&(x.cancelAnimationFrame(r),t._scheduled=void 0)}});var Ot=c(7921),xt=c(5619),F=c(7398),Q=c(3997);const qe={id:1,x:0,y:100,name:"Node 1"};let X=(()=>{var n;class t{constructor(){this._nodes$=new xt.X([qe]),this.nodes$=this._nodes$.asObservable(),this._arrows$=new xt.X([]),this.arrows$=this._arrows$.asObservable()}getNodeSnapshot(e){return this._nodes$.getValue().find(s=>s.id===e)}getNode$(e){return this._nodes$.pipe((0,F.U)(s=>s.find(i=>i.id===e)),(0,G.h)(s=>!!s),(0,Q.x)())}putNodeToLast(e){const s=this._nodes$.getValue(),i=s.find(a=>a.id===e);i&&this._nodes$.next([...s.filter(a=>a.id!==e),i])}updateNode(e,s){this._nodes$.next(this._nodes$.getValue().map(i=>i.id===e?{...i,...s}:i))}addNode(e,s){const i=Math.max(0,...this._nodes$.getValue().map(a=>a.id))+1;this._nodes$.next([...this._nodes$.getValue(),{...e,id:i,name:`Node ${i}`}]),this.addArrow({start:s,end:i})}deleteNode(e){this._arrows$.next(this._arrows$.getValue().filter(s=>s.start!==e&&s.end!==e)),this._nodes$.next(this._nodes$.getValue().filter(s=>s.id!==e))}addArrow(e){const s=Math.max(0,...this._arrows$.getValue().map(i=>i.id))+1;this._arrows$.next([...this._arrows$.getValue(),{...e,id:s}])}getArrowSnapshot(e){return this._arrows$.getValue().find(s=>s.id===e)}}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275prov=o.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();var We=c(7715),Ze=c(5592),ze=c(7453),Je=c(9940),Qe=c(7400),Xe=c(2714);let Ft=(()=>{var n;class t{constructor(e,s){this._renderer=e,this._elementRef=s,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(e,s){this._renderer.setProperty(this._elementRef.nativeElement,e,s)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return(n=t).\u0275fac=function(e){return new(e||n)(o.Y36(o.Qsj),o.Y36(o.SBq))},n.\u0275dir=o.lG2({type:n}),t})(),M=(()=>{var n;class t extends Ft{}return(n=t).\u0275fac=function(){let r;return function(s){return(r||(r=o.n5z(n)))(s||n)}}(),n.\u0275dir=o.lG2({type:n,features:[o.qOj]}),t})();const y=new o.OlP("NgValueAccessor"),en={provide:y,useExisting:(0,o.Gpc)(()=>k),multi:!0},rn=new o.OlP("CompositionEventMode");let k=(()=>{var n;class t extends Ft{constructor(e,s,i){super(e,s),this._compositionMode=i,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function nn(){const n=(0,_.q)()?(0,_.q)().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return(n=t).\u0275fac=function(e){return new(e||n)(o.Y36(o.Qsj),o.Y36(o.SBq),o.Y36(rn,8))},n.\u0275dir=o.lG2({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,s){1&e&&o.NdJ("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[o._Bn([en]),o.qOj]}),t})();const p=new o.OlP("NgValidators"),V=new o.OlP("NgAsyncValidators");function Ut(n){return null!=n}function $t(n){return(0,o.QGY)(n)?(0,We.D)(n):n}function jt(n){let t={};return n.forEach(r=>{t=null!=r?{...t,...r}:t}),0===Object.keys(t).length?null:t}function Lt(n,t){return t.map(r=>r(n))}function Yt(n){return n.map(t=>function sn(n){return!n.validate}(t)?t:r=>t.validate(r))}function K(n){return null!=n?function qt(n){if(!n)return null;const t=n.filter(Ut);return 0==t.length?null:function(r){return jt(Lt(r,t))}}(Yt(n)):null}function tt(n){return null!=n?function Wt(n){if(!n)return null;const t=n.filter(Ut);return 0==t.length?null:function(r){return function Ke(...n){const t=(0,Je.jO)(n),{args:r,keys:e}=(0,ze.D)(n),s=new Ze.y(i=>{const{length:a}=r;if(!a)return void i.complete();const l=new Array(a);let u=a,h=a;for(let f=0;f<a;f++){let g=!1;(0,wt.Xf)(r[f]).subscribe((0,J.x)(i,v=>{g||(g=!0,h--),l[f]=v},()=>u--,void 0,()=>{(!u||!g)&&(h||i.next(e?(0,Xe.n)(e,l):l),i.complete())}))}});return t?s.pipe((0,Qe.Z)(t)):s}(Lt(r,t).map($t)).pipe((0,F.U)(jt))}}(Yt(n)):null}function Zt(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function zt(n){return n._rawValidators}function Jt(n){return n._rawAsyncValidators}function et(n){return n?Array.isArray(n)?n:[n]:[]}function H(n,t){return Array.isArray(n)?n.includes(t):n===t}function Qt(n,t){const r=et(t);return et(n).forEach(s=>{H(r,s)||r.push(s)}),r}function Xt(n,t){return et(t).filter(r=>!H(n,r))}class Kt{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=K(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=tt(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,r){return!!this.control&&this.control.hasError(t,r)}getError(t,r){return this.control?this.control.getError(t,r):null}}class A extends Kt{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class te{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let ee=(()=>{var n;class t extends te{constructor(e){super(e)}}return(n=t).\u0275fac=function(e){return new(e||n)(o.Y36(A,2))},n.\u0275dir=o.lG2({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,s){2&e&&o.ekj("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[o.qOj]}),t})();const N="VALID",U="INVALID",E="PENDING",S="DISABLED";function $(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class se{constructor(t,r){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(r)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===N}get invalid(){return this.status===U}get pending(){return this.status==E}get disabled(){return this.status===S}get enabled(){return this.status!==S}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(Qt(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(Qt(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(Xt(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(Xt(t,this._rawAsyncValidators))}hasValidator(t){return H(this._rawValidators,t)}hasAsyncValidator(t){return H(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(r=>{r.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=E,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const r=this._parentMarkedDirty(t.onlySelf);this.status=S,this.errors=null,this._forEachChild(e=>{e.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:r}),this._onDisabledChange.forEach(e=>e(!0))}enable(t={}){const r=this._parentMarkedDirty(t.onlySelf);this.status=N,this._forEachChild(e=>{e.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:r}),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===N||this.status===E)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(r=>r._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?S:N}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=E,this._hasOwnPendingAsyncValidator=!0;const r=$t(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(e=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(e,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,r={}){this.errors=t,this._updateControlsErrors(!1!==r.emitEvent)}get(t){let r=t;return null==r||(Array.isArray(r)||(r=r.split(".")),0===r.length)?null:r.reduce((e,s)=>e&&e._find(s),this)}getError(t,r){const e=r?this.get(r):this;return e&&e.errors?e.errors[t]:null}hasError(t,r){return!!this.getError(t,r)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new o.vpe,this.statusChanges=new o.vpe}_calculateStatus(){return this._allControlsDisabled()?S:this.errors?U:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(E)?E:this._anyControlsHaveStatus(U)?U:N}_anyControlsHaveStatus(t){return this._anyControls(r=>r.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){$(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function dn(n){return Array.isArray(n)?K(n):n||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function hn(n){return Array.isArray(n)?tt(n):n||null}(this._rawAsyncValidators)}}const O=new o.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>j}),j="always";function I(n,t,r=j){(function at(n,t){const r=zt(n);null!==t.validator?n.setValidators(Zt(r,t.validator)):"function"==typeof r&&n.setValidators([r]);const e=Jt(n);null!==t.asyncValidator?n.setAsyncValidators(Zt(e,t.asyncValidator)):"function"==typeof e&&n.setAsyncValidators([e]);const s=()=>n.updateValueAndValidity();q(t._rawValidators,s),q(t._rawAsyncValidators,s)})(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||"always"===r)&&t.valueAccessor.setDisabledState?.(n.disabled),function gn(n,t){t.valueAccessor.registerOnChange(r=>{n._pendingValue=r,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&ie(n,t)})}(n,t),function _n(n,t){const r=(e,s)=>{t.valueAccessor.writeValue(e),s&&t.viewToModelUpdate(e)};n.registerOnChange(r),t._registerOnDestroy(()=>{n._unregisterOnChange(r)})}(n,t),function mn(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&ie(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function pn(n,t){if(t.valueAccessor.setDisabledState){const r=e=>{t.valueAccessor.setDisabledState(e)};n.registerOnDisabledChange(r),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(r)})}}(n,t)}function Y(n,t,r=!0){const e=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(e),t.valueAccessor.registerOnTouched(e)),function W(n,t){let r=!1;if(null!==n){if(null!==t.validator){const s=zt(n);if(Array.isArray(s)&&s.length>0){const i=s.filter(a=>a!==t.validator);i.length!==s.length&&(r=!0,n.setValidators(i))}}if(null!==t.asyncValidator){const s=Jt(n);if(Array.isArray(s)&&s.length>0){const i=s.filter(a=>a!==t.asyncValidator);i.length!==s.length&&(r=!0,n.setAsyncValidators(i))}}}const e=()=>{};return q(t._rawValidators,e),q(t._rawAsyncValidators,e),r}(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function q(n,t){n.forEach(r=>{r.registerOnValidatorChange&&r.registerOnValidatorChange(t)})}function ie(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function ue(n,t){const r=n.indexOf(t);r>-1&&n.splice(r,1)}function ce(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const ht=class extends se{constructor(t=null,r,e){super(function ot(n){return($(n)?n.validators:n)||null}(r),function st(n,t){return($(t)?t.asyncValidators:n)||null}(e,r)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(r),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),$(r)&&(r.nonNullable||r.initialValueIsDefault)&&(this.defaultValue=ce(t)?t.value:t)}setValue(t,r={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==r.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==r.emitViewToModelChange)),this.updateValueAndValidity(r)}patchValue(t,r={}){this.setValue(t,r)}reset(t=this.defaultValue,r={}){this._applyFormState(t),this.markAsPristine(r),this.markAsUntouched(r),this.setValue(this.value,r),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){ue(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){ue(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){ce(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};let me=(()=>{var n;class t{}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({}),t})();const ft=new o.OlP("NgModelWithFormControlWarning"),Nn={provide:A,useExisting:(0,o.Gpc)(()=>pt)};let pt=(()=>{var n;class t extends A{set isDisabled(e){}constructor(e,s,i,a,l){super(),this._ngModelWarningConfig=a,this.callSetDisabledState=l,this.update=new o.vpe,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(s),this.valueAccessor=function ct(n,t){if(!t)return null;let r,e,s;return Array.isArray(t),t.forEach(i=>{i.constructor===k?r=i:function Cn(n){return Object.getPrototypeOf(n.constructor)===M}(i)?e=i:s=i}),s||e||r||null}(0,i)}ngOnChanges(e){if(this._isControlChanged(e)){const s=e.form.previousValue;s&&Y(s,this,!1),I(this.form,this,this.callSetDisabledState),this.form.updateValueAndValidity({emitEvent:!1})}(function ut(n,t){if(!n.hasOwnProperty("model"))return!1;const r=n.model;return!!r.isFirstChange()||!Object.is(t,r.currentValue)})(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Y(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return(n=t)._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(o.Y36(p,10),o.Y36(V,10),o.Y36(y,10),o.Y36(ft,8),o.Y36(O,8))},n.\u0275dir=o.lG2({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[o._Bn([Nn]),o.qOj,o.TTD]}),t})(),Jn=(()=>{var n;class t{}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[me]}),t})(),Xn=(()=>{var n;class t{static withConfig(e){return{ngModule:t,providers:[{provide:ft,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:O,useValue:e.callSetDisabledState??j}]}}}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[Jn]}),t})();const d_CIRCLE_RADIUS=8,d_LINE_HEIGHT=24,d_RECT_WIDTH=168,d_RECT_HEIGHT=96,Kn=["ghost"],tr=["lcdNode",""];let er=(()=>{var n;class t{constructor(){this.cdr=(0,o.f3M)(o.sBO),this.store=(0,o.f3M)(X),this.renderer=(0,o.f3M)(o.Qsj),this.elementRef=(0,o.f3M)(o.SBq),this.drawArrow=new o.vpe,this.x=0,this.y=100,this.nameCtrl=new ht("",{nonNullable:!0}),this.editing=!1}ngOnInit(){const e=this.store.getNodeSnapshot(this.nodeId);this.x=e.x,this.y=e.y,this.nameCtrl.setValue(e.name)}get transform(){return`translate(${this.x}, ${this.y})`}onMouseDown(e){this.store.putNodeToLast(this.nodeId),this.renderer.addClass(this.elementRef.nativeElement,"dragging");const s={x:this.x,y:this.y};let i=!1;const a=(0,b.R)(document,"keydown").pipe((0,G.h)(u=>"Escape"===u.key),(0,Dt.b)(()=>i=!0)),l=(0,b.R)(document,"mouseup").pipe((0,Mt.x)(()=>{i||(this.x+=s.x,this.y+=s.y,this.store.updateNode(this.nodeId,{x:this.x,y:this.y})),this.renderer.removeClass(this.elementRef.nativeElement,"dragging"),this.cdr.markForCheck()}));(0,b.R)(document,"mousemove").pipe((0,P.R)(l),(0,P.R)(a),bt(0,Et),(0,Ot.O)(e),(0,G.h)(()=>!i)).subscribe(u=>{s.x=u.clientX-e.clientX,s.y=u.clientY-e.clientY,this.ghostRef.nativeElement.setAttribute("transform",`translate(${s.x}, ${s.y})`)})}edit(e){this.editing=!0,setTimeout(()=>{e.focus(),e.select()})}cancelEdit(){this.editing=!1,this.nameCtrl.setValue(this.store.getNodeSnapshot(this.nodeId).name)}validateEdition(){this.editing=!1,this.store.updateNode(this.nodeId,{name:this.nameCtrl.value})}addNode(){this.store.addNode({x:this.x+1.5*d_RECT_WIDTH,y:this.y},this.nodeId),this.store.putNodeToLast(this.nodeId)}deleteNode(){this.store.deleteNode(this.nodeId)}}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=o.Xpm({type:n,selectors:[["","lcdNode",""]],viewQuery:function(e,s){if(1&e&&o.Gf(Kn,5),2&e){let i;o.iGM(i=o.CRH())&&(s.ghostRef=i.first)}},hostVars:2,hostBindings:function(e,s){2&e&&o.uIk("data-node-id",s.nodeId)("transform",s.transform)},inputs:{nodeId:"nodeId"},outputs:{drawArrow:"drawArrow"},standalone:!0,features:[o.jDz],attrs:tr,decls:25,vars:4,consts:[[1,"content",3,"mousedown"],["xmlns","http://www.w3.org/1999/xhtml"],[1,"label",3,"dblclick"],[3,"formControl","mousedown","keydown.escape","keydown.enter","blur"],["input",""],[1,"menu"],[3,"click"],[1,"ri-add-line"],[1,"ri-delete-bin-line"],[1,"ghost"],["ghost",""]],template:function(e,s){if(1&e){const i=o.EpF();o.O4$(),o._UZ(0,"rect"),o.TgZ(1,"foreignObject",0),o.NdJ("mousedown",function(l){return s.onMouseDown(l)}),o.kcU(),o.TgZ(2,"div",1)(3,"div",2),o.NdJ("dblclick",function(){o.CHM(i);const l=o.MAs(7);return o.KtG(s.edit(l))}),o.TgZ(4,"pre"),o._uU(5),o.qZA()(),o.TgZ(6,"textarea",3,4),o.NdJ("mousedown",function(l){return l.stopPropagation()})("keydown.escape",function(){return s.cancelEdit()})("keydown.enter",function(){return s.validateEdition()})("blur",function(){return s.validateEdition()}),o.qZA()()(),o.O4$(),o.TgZ(8,"foreignObject",5),o.kcU(),o.TgZ(9,"div",1)(10,"ul")(11,"li")(12,"button",6),o.NdJ("click",function(){return s.addNode()}),o._UZ(13,"i",7),o._uU(14," N\u0153ud"),o.qZA()(),o.TgZ(15,"li")(16,"button",6),o.NdJ("click",function(l){return s.drawArrow.next(l)}),o._UZ(17,"i",7),o._uU(18," Lien"),o.qZA()(),o.TgZ(19,"li")(20,"button",6),o.NdJ("click",function(){return s.deleteNode()}),o._UZ(21,"i",8),o._uU(22," Supprimer"),o.qZA()()()()(),o.O4$(),o._UZ(23,"rect",9,10)}2&e&&(o.xp6(1),o.ekj("editing",s.editing),o.xp6(4),o.Oqu(s.nameCtrl.value),o.xp6(1),o.Q6J("formControl",s.nameCtrl))},dependencies:[_.ez,Xn,k,ee,pt],styles:["[_nghost-%COMP%]{cursor:grab}.drawing-arrow   [_nghost-%COMP%]{cursor:pointer}rect[_ngcontent-%COMP%]{fill:#fff;stroke:#000;width:var(--rect-width);height:var(--rect-height);rx:var(--circle-radius)}.content[_ngcontent-%COMP%]{width:var(--rect-width);height:var(--rect-height);padding:calc(var(--line-height) / 2)}.label[_ngcontent-%COMP%]{width:100%;height:calc(var(--line-height) * 3);display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;line-height:var(--line-height);text-align:center;-webkit-user-select:none;user-select:none}.editing[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:none}textarea[_ngcontent-%COMP%]{display:none;width:100%;height:calc(var(--line-height) * 3);border:none;line-height:var(--line-height);outline:none}.editing[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{display:block}.menu[_ngcontent-%COMP%]{width:100px;transform:translate(var(--rect-width));overflow:visible;opacity:0;pointer-events:none;transition:opacity .2s ease-in-out}[_nghost-%COMP%]:hover   .menu[_ngcontent-%COMP%]{opacity:1;pointer-events:auto}.menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:var(--space-s)}.menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:transparent;color:var(--color-primary-darker);white-space:nowrap;padding:0;opacity:.5}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}.ghost[_ngcontent-%COMP%]{opacity:0;pointer-events:none}.dragging[_nghost-%COMP%]   rect[_ngcontent-%COMP%]{stroke:#0000004d}.dragging[_nghost-%COMP%]   .ghost[_ngcontent-%COMP%]{opacity:1;stroke:#000}"],changeDetection:0}),t})();var nr=c(2572);function Vt(n,t){return n.x>=Math.min(t.start.x,t.end.x)&&n.x<=Math.max(t.start.x,t.end.x)&&n.y>=Math.min(t.start.y,t.end.y)&&n.y<=Math.max(t.start.y,t.end.y)}function z(n,t){const r=(n.start.x-n.end.x)*(t.start.y-t.end.y)-(n.start.y-n.end.y)*(t.start.x-t.end.x);if(0===r)return null;const e=((n.start.x-t.start.x)*(t.start.y-t.end.y)-(n.start.y-t.start.y)*(t.start.x-t.end.x))/r,s=-((n.start.x-n.end.x)*(n.start.y-t.start.y)-(n.start.y-n.end.y)*(n.start.x-t.start.x))/r;return e>=0&&e<=1&&s>=0&&s<=1?{x:n.start.x+e*(n.end.x-n.start.x),y:n.start.y+e*(n.end.y-n.start.y)}:null}function Se(n,t){if(n.x===t.x)return{x:t.x+d_RECT_WIDTH/2,y:t.y+(n.y<t.y?0:d_RECT_HEIGHT)};const r={start:{x:n.x+d_RECT_WIDTH/2,y:n.y+d_RECT_HEIGHT/2},end:{x:t.x+d_RECT_WIDTH/2,y:t.y+d_RECT_HEIGHT/2}},e=t.y+d_CIRCLE_RADIUS,s=t.y+d_RECT_HEIGHT-d_CIRCLE_RADIUS,i=t.x+d_CIRCLE_RADIUS,a=t.x+d_RECT_WIDTH-d_CIRCLE_RADIUS,u=[{x:i,y:e},{x:i,y:s},{x:a,y:e},{x:a,y:s}].flatMap(D=>function rr(n,t,r){if(n.end.x===n.start.x)throw new Error("Not implemented");const e=(n.end.y-n.start.y)/(n.end.x-n.start.x),s=n.start.y-e*n.start.x,i=1+e*e,a=2*e*s-2*t.x-2*t.y*e,u=a*a-4*i*(t.x**2+s**2-2*s*t.y+t.y**2-r**2),h=[];if(0===u){const f=-a/(2*i),g=e*f+s;Vt({x:f,y:g},n)&&h.push({x:f,y:g})}else if(u>0){const f=(-a+Math.sqrt(u))/(2*i),g=e*f+s;Vt({x:f,y:g},n)&&h.push({x:f,y:g});const v=(-a-Math.sqrt(u))/(2*i),D=e*v+s;Vt({x:v,y:D},n)&&h.push({x:v,y:D})}return h}(r,D,d_CIRCLE_RADIUS)).reduce((D,Te)=>!D||Math.abs(r.start.x-Te.x)<Math.abs(r.start.x-D.x)?Te:D,null);if(u)return u;const h=t.y,f=t.y+d_RECT_HEIGHT,g=t.x,v=t.x+d_RECT_WIDTH;return z(r,{start:{x:g,y:h},end:{x:v,y:h}})||z(r,{start:{x:g,y:h},end:{x:g,y:f}})||z(r,{start:{x:g,y:f},end:{x:v,y:f}})||z(r,{start:{x:v,y:h},end:{x:v,y:f}})}const or=["lcdArrow",""];let sr=(()=>{var n;class t{constructor(){this.store=(0,o.f3M)(X)}ngOnInit(){const e=this.store.getArrowSnapshot(this.arrowId);this.path$=(0,nr.a)([this.store.getNode$(e.start),this.store.getNode$(e.end)]).pipe((0,F.U)(([s,i])=>{const a_x=s.x+d_RECT_WIDTH/2,a_y=s.y+d_RECT_HEIGHT/2,l=Se(s,i);return`M ${a_x} ${a_y} L ${l?.x||0} ${l?.y||0}`}),(0,Q.x)())}}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=o.Xpm({type:n,selectors:[["","lcdArrow",""]],inputs:{arrowId:"arrowId"},standalone:!0,features:[o.jDz],attrs:or,decls:2,vars:3,consts:[["marker-end","url(#arrowhead)"]],template:function(e,s){1&e&&(o.O4$(),o._UZ(0,"path",0),o.ALo(1,"async")),2&e&&o.uIk("d",o.lcZ(1,1,s.path$))},dependencies:[_.ez,_.Ov],styles:["path[_ngcontent-%COMP%]{stroke:#000;fill:none;stroke-width:2}"],changeDetection:0}),t})();const ir=["svgContainerRef"];function ar(n,t){1&n&&(o.O4$(),o._UZ(0,"g",6)),2&n&&o.Q6J("arrowId",t.$implicit.id)}function lr(n,t){if(1&n&&(o.O4$(),o._UZ(0,"path",7)),2&n){const r=o.oxw();o.uIk("d",r.ghostArrowPath)}}function ur(n,t){if(1&n){const r=o.EpF();o.O4$(),o.TgZ(0,"g",8),o.NdJ("drawArrow",function(s){const a=o.CHM(r).$implicit,l=o.oxw();return o.KtG(l.drawArrowFrom(a,s))}),o.qZA()}2&n&&o.Q6J("nodeId",t.$implicit.id)}let cr=(()=>{var n;class t{constructor(){this.cdr=(0,o.f3M)(o.sBO),this.store=(0,o.f3M)(X),this.elementRef=(0,o.f3M)(o.SBq),this.renderer=(0,o.f3M)(o.Qsj),this.nodes$=this.store.nodes$,this.arrows$=this.store.arrows$,this.ghostArrowPath=null}ngAfterViewInit(){const e=this.elementRef.nativeElement;e.style.setProperty("--circle-radius",`${d_CIRCLE_RADIUS}px`),e.style.setProperty("--line-height",`${d_LINE_HEIGHT}px`),e.style.setProperty("--rect-width",`${d_RECT_WIDTH}px`),e.style.setProperty("--rect-height",`${d_RECT_HEIGHT}px`)}ngAfterViewChecked(){const{width:e,height:s}=this.svgContainerRef.nativeElement.getBoundingClientRect(),i=`-10 -10 ${e-10} ${s-10}`;i!==this.viewBox&&(this.viewBox=i,this.cdr.detectChanges())}trackById(e,s){return s.id}drawArrowFrom(e,s){this.renderer.addClass(this.svgContainerRef.nativeElement,"drawing-arrow");const i=(0,b.R)(document,"keydown").pipe((0,G.h)(l=>"Escape"===l.key)),a=(0,b.R)(document,"mousedown").pipe((0,Dt.b)(l=>{const u=l.target.closest("g")?.attributes.getNamedItem("data-node-id")?.value;u&&this.store.addArrow({start:e.id,end:+u})}),(0,Mt.x)(()=>{this.ghostArrowPath=null,this.renderer.removeClass(this.svgContainerRef.nativeElement,"drawing-arrow"),this.cdr.markForCheck()}));(0,b.R)(document,"mousemove").pipe((0,P.R)(a),(0,P.R)(i),bt(0,Et),(0,Ot.O)(s),(0,F.U)(l=>({nodeId:l.target.closest("g")?.attributes.getNamedItem("data-node-id")?.value,event:l})),(0,Q.x)(({nodeId:l},{nodeId:u})=>!!u&&l===u),(0,F.U)(({nodeId:l,event:u})=>{if(!l){const{top:f,left:g}=this.svgContainerRef.nativeElement.getBoundingClientRect();return{x:u.clientX-g,y:u.clientY-f}}const h=this.store.getNodeSnapshot(+l);return Se(e,h)})).subscribe(l=>{this.ghostArrowPath=`M${e.x+d_RECT_WIDTH/2},${e.y+d_RECT_HEIGHT/2} L${l.x},${l.y}`,this.cdr.markForCheck()})}}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=o.Xpm({type:n,selectors:[["lcd-diagram"]],viewQuery:function(e,s){if(1&e&&o.Gf(ir,5),2&e){let i;o.iGM(i=o.CRH())&&(s.svgContainerRef=i.first)}},standalone:!0,features:[o.jDz],decls:10,vars:10,consts:[["svgContainerRef",""],["id","arrowhead","markerWidth","6","markerHeight","4","refX","5","refY","2","orient","auto"],["points","0 0, 6 2, 0 4"],["lcdArrow","",3,"arrowId",4,"ngFor","ngForOf","ngForTrackBy"],["marker-end","url(#arrowhead)",4,"ngIf"],["lcdNode","",3,"nodeId","drawArrow",4,"ngFor","ngForOf","ngForTrackBy"],["lcdArrow","",3,"arrowId"],["marker-end","url(#arrowhead)"],["lcdNode","",3,"nodeId","drawArrow"]],template:function(e,s){1&e&&(o.O4$(),o.TgZ(0,"svg",null,0)(2,"defs")(3,"marker",1),o._UZ(4,"polygon",2),o.qZA()(),o.YNc(5,ar,1,1,"g",3),o.ALo(6,"async"),o.YNc(7,lr,1,1,"path",4),o.YNc(8,ur,1,1,"g",5),o.ALo(9,"async"),o.qZA()),2&e&&(o.uIk("viewBox",s.viewBox),o.xp6(5),o.Q6J("ngForOf",o.lcZ(6,6,s.arrows$))("ngForTrackBy",s.trackById),o.xp6(2),o.Q6J("ngIf",s.ghostArrowPath),o.xp6(1),o.Q6J("ngForOf",o.lcZ(9,8,s.nodes$))("ngForTrackBy",s.trackById))},dependencies:[_.ez,_.sg,_.O5,_.Ov,er,sr],styles:["svg[_ngcontent-%COMP%]{border:1px solid black;width:100%;height:600px}svg.drawing-arrow[_ngcontent-%COMP%]{cursor:none}path[_ngcontent-%COMP%]{stroke:#000;stroke-width:2}"],changeDetection:0}),t})();const Ie=function(){return["ts","svg","scss"]},dr=function(){return["ts"]};let hr=(()=>{var n;class t{}return(n=t).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=o.Xpm({type:n,selectors:[["lcd-diagram-page"]],standalone:!0,features:[o.jDz],decls:13,vars:6,consts:[["path","./app/features/05-diagram/diagram/diagram.component"],["path","./app/features/05-diagram/diagram/arrow/arrow.component",3,"supportedExtension"],["path","./app/features/05-diagram/diagram/node/node.component",3,"supportedExtension"],["path","./app/features/05-diagram/diagram/diagram.store",3,"supportedExtension"],[1,"controls"],["routerLink","../04-cubic-bezier"]],template:function(e,s){1&e&&(o.TgZ(0,"h3"),o._uU(1,"Diagramme interactif, un exemple complet"),o.qZA(),o.TgZ(2,"p")(3,"em"),o._uU(4,"Ne prends pas encompte les \xe9v\xe9nements mobiles"),o.qZA()(),o.TgZ(5,"lcd-code-reader",0),o._UZ(6,"lcd-diagram"),o.qZA(),o._UZ(7,"lcd-code-reader",1)(8,"lcd-code-reader",2)(9,"lcd-code-reader",3),o.TgZ(10,"div",4)(11,"button",5),o._uU(12,"Pr\xe9c\xe9dent"),o.qZA()()),2&e&&(o.xp6(7),o.Q6J("supportedExtension",o.DdM(3,Ie)),o.xp6(1),o.Q6J("supportedExtension",o.DdM(4,Ie)),o.xp6(1),o.Q6J("supportedExtension",o.DdM(5,dr)))},dependencies:[_.ez,Ge.rH,Pe.E,cr],changeDetection:0}),t})()}}]);